<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Películas - WatchPY</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* Personalización de colores */
        .bg-navbar {
            background-color: transparent;
        }

        .bg-jumbotron {
            background-image: url('https://source.unsplash.com/1600x900/?movie');
            background-size: cover;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 50px;
        }

        .text-jumbotron {
            color: #ffffff;
        }

        .bg-footer {
            background-color: #0D47A1;
        }

        .text-footer {
            color: #ffffff;
        }
    </style>
</head>

<body class="bg-gray-900 text-white flex flex-col min-h-screen">

    <!-- Barra de navegación -->
    <nav class="bg-navbar p-4 absolute w-full z-10">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#" class="text-2xl font-bold flex items-center">
                <!-- Inserta tu logo SVG aquí -->
                WatchPY
            </a>
            <button class="navbar-toggler md:hidden" aria-label="Abrir menú">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7">
                    </path>
                </svg>
            </button>
            <div class="hidden md:flex md:items-center" id="navbarNav">
                <div class="flex items-center">
                    <!-- Botón de idioma -->
                    <button class="mr-4 bg-transparent text-lg focus:outline-none">Español</button>                    
                </div>
            </div>
            
        </div>
    </nav>

    <!-- Contenido principal -->
    <div class="flex-grow bg-jumbotron">
        <div class="container mx-auto px-4 py-16">
            <h2 class="text-3xl font-bold text-center mb-8">Películas</h2>
            <div id="movieList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer bg-footer text-footer">
        <div class="container mx-auto px-4 py-8 text-center">
            <p>&copy; 2024 WatchPY</p>
            <ul class="flex justify-center mt-4">
                <li class="mr-6"><a href="#" class="text-white">Términos de servicio</a></li>
                <li class="mr-6"><a href="#" class="text-white">Política de privacidad</a></li>
                <li><a href="#" class="text-white">Contacto</a></li>
            </ul>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const isLoggedIn = checkLoggedInStatus();

            if (isLoggedIn) {
                fetchMovies(); // Obtener y mostrar las películas si el usuario está autenticado
            } else {
                alert('Inicia sesión para ver las películas.');
                window.location.href = 'login.html'; // Redireccionar a la página de inicio de sesión si no hay sesión
            }
        });

        function checkLoggedInStatus() {
            // Verificar el estado de inicio de sesión aquí
            // Puedes usar localStorage, cookies, o verificar con el backend
            // Ejemplo simple usando localStorage (solo demostrativo)
            const token = localStorage.getItem('accessToken');
            return !!token; // Devuelve true si hay un token de acceso
        }

        async function fetchMovies() {
            try {
                const token = localStorage.getItem('accessToken');
                if (!token) {
                    throw new Error('No se encontró el token de acceso');
                }
        
                const response = await fetch('URL_DEL_BACKEND/api/movies', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                });
        
                if (response.ok) {
                    const movies = await response.json();
                    displayMovies(movies);
                } else {
                    throw new Error('Error al obtener las películas');
                }
            } catch (error) {
                console.error('Error:', error.message);
                alert('Ocurrió un error al obtener las películas.');
            }
        }
        function displayMovies(movies) {
            const movieListContainer = document.getElementById('movieList');
            movieListContainer.innerHTML = '';

            movies.forEach(movie => {
                const movieCard = document.createElement('div');
                movieCard.className = 'bg-gray-800 p-4 rounded-lg shadow-lg';
                movieCard.innerHTML = `
                    <img src="${movie.poster_url}" alt="${movie.title}" class="w-full h-48 object-cover mb-2">
                    <h3 class="text-lg font-bold">${movie.title}</h3>
                    <p class="text-sm text-gray-400">${movie.genre}</p>
                `;

                movieListContainer.appendChild(movieCard);
            });
        }
    </script>

</body>

</html>
